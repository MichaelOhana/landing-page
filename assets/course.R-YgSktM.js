(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function o(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=o(s);fetch(s.href,i)}})();function T(t){let e=t.length,o;for(;e!==0;)o=Math.floor(Math.random()*e),e--,[t[e],t[o]]=[t[o],t[e]];return t}function C(t){if(!t)return"";if(t.length===11&&/^[a-zA-Z0-9_-]+$/.test(t))return t;const e=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/,o=t.match(e);return o&&o[2].length===11?o[2]:t}function A(t,e=10,o=null){if(!t)return"";const r=`<span class="inline-block border-b-2 border-gray-400 mx-1" style="min-width: ${Math.max(50,e*8)}px;"></span>`;let s=t.replace(/___BLANK___/g,r);if(o&&s===t){const i=new RegExp(`\\b${o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\b`,"gi");s=s.replace(i,r)}return s}function _(t,e){const o=document.getElementById(e);if(!o){console.error("[renderYouTubeClips] Container not found:",e);return}if(!t||t.length===0){o.innerHTML=`
            <div class="text-gray-500 italic p-6 bg-gray-50 rounded-lg text-center">
                No YouTube clips available for this word.
            </div>
        `;return}console.log("[renderYouTubeClips] Rendering",t.length,"clips");const r=`
        <div class="space-y-4">
            <h3 class="text-2xl font-semibold text-purple-700 mb-4 border-b-2 border-purple-200 pb-2">YouTube Clips</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${t.map((s,i)=>`
                        <div class="relative rounded-lg overflow-hidden shadow-md bg-black" style="padding-bottom: 56.25%;">
                            <iframe class="absolute top-0 left-0 w-full h-full"
                                src="https://www.youtube-nocookie.com/embed/${C(s.youtube_url)}?start=${s.start_sec||0}&rel=0&modestbranding=1"
                                frameborder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen>
                            </iframe>
                        </div>
                    `).join("")}
            </div>
        </div>
    `;o.innerHTML=r}const O=Object.freeze(Object.defineProperty({__proto__:null,formatSentenceWithBlank:A,getYouTubeVideoId:C,renderYouTubeClips:_,shuffleArray:T},Symbol.toStringTag,{value:"Module"})),x="Spanish",v=5,M="100_EN_real_estate.sqlite3",N="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/",E={MENU:"views/menu.html",WORD_DETAIL:"views/word-detail.html",PRACTICE:"views/practice.html"};async function R(){try{console.log("Loading SQL.js WASM...");const t=await window.initSqlJs({locateFile:r=>`${N}${r}`});console.log("Fetching database file:",M);const e=await fetch(M);if(!e.ok)throw new Error(`Failed to fetch database: ${e.statusText}`);const o=await e.arrayBuffer();console.log("Creating database instance..."),this.db=new t.Database(new Uint8Array(o)),console.log("Database loaded successfully.")}catch(t){throw console.error("Database initialization error:",t),this.error=(this.error?this.error+"; ":"")+(t.message||"An unknown error occurred during DB initialization."),t}}function I(t,e=[]){if(!this.db)return console.error("Database not initialized."),this.error="Database not initialized. Cannot execute query.",null;try{const o=this.db.prepare(t);o.bind(e);const r=[];for(;o.step();)r.push(o.getAsObject());return o.free(),r}catch(o){return console.error("Error executing query:",t,o),this.error=`Query failed: ${o.message}`,null}}async function D(){this.isLoadingHtmlViews=!0,console.log("[viewLoader.js] Loading HTML views...");try{const[t,e]=await Promise.all([fetch(E.WORD_DETAIL),fetch(E.PRACTICE)]);if(!t.ok)throw new Error(`Failed to fetch ${E.WORD_DETAIL}: ${t.statusText}`);if(this.wordDetailViewHtml=await t.text(),!e.ok)throw new Error(`Failed to fetch ${E.PRACTICE}: ${e.statusText}`);this.practiceViewHtml=await e.text(),console.log("[viewLoader.js] HTML views loaded successfully.")}catch(t){console.error("[viewLoader.js] Error loading HTML views:",t),this.error=(this.error?this.error+"; ":"")+`Failed to load page templates: ${t.message}`,this.wordDetailViewHtml||(this.wordDetailViewHtml='<p class="text-red-500 text-center">Error loading word detail view. Please refresh.</p>'),this.practiceViewHtml||(this.practiceViewHtml='<p class="text-red-500 text-center">Error loading practice view. Please refresh.</p>')}finally{this.isLoadingHtmlViews=!1}}function F(t){if(!t){console.warn("No audio data to play.");return}try{let e;if(t instanceof Blob)e=t;else if(t instanceof ArrayBuffer||t instanceof Uint8Array)e=new Blob([t],{type:"audio/mpeg"});else{console.error("Unsupported audio data type:",t);return}const o=URL.createObjectURL(e);this.audioPlayer?(this.audioPlayer.src=o,this.audioPlayer.play().catch(r=>console.error("Error playing audio:",r))):console.error("Audio player not initialized on appState.")}catch(e){console.error("Error processing audio data:",e)}}const H=Object.freeze(Object.defineProperty({__proto__:null,playAudio:F},Symbol.toStringTag,{value:"Module"}));function $(){if(!this.db){this.error="Database not available to load modules.",console.error(this.error);return}const e=this.executeQuery("SELECT id, name, description FROM modules ORDER BY name;");e?(this.modules=e,console.log("Modules loaded:",this.modules)):console.error("Failed to load modules.")}function j(t){console.log(`Module selected: ${t}`),this.selectedModuleId=t,this.selectedWordId=null,this.wordsInSelectedModule=[],this.clearWordDetails(),this.viewedWordsInModule.clear(),this.midModulePracticeCompleted=!1,this.endModulePracticeCompleted=!1,this.isPracticeActive=!1,t&&this.loadWordsForModule(t)}function k(t){if(!this.db){this.error="Database not available to load words.",console.error(this.error);return}const o=this.executeQuery(`
        SELECT w.id, w.term
        FROM words w
        JOIN word_module_assignments wma ON w.id = wma.word_id
        WHERE wma.module_id = ?
        ORDER BY w.term;
    `,[t]);o?(this.wordsInSelectedModule=o,console.log(`Words for module ${t}:`,this.wordsInSelectedModule),this.wordsInSelectedModule.length===0&&console.warn(`No words found for module ${t}.`)):console.error(`Failed to load words for module ${t}.`)}const Q=Object.freeze(Object.defineProperty({__proto__:null,loadModules:$,loadWordsForModule:k,selectModule:j},Symbol.toStringTag,{value:"Module"}));function B(t){if(!this.selectedModuleId||!t)return;this.viewedWordsInModule.add(t),console.log(`Viewed words in module ${this.selectedModuleId}:`,Array.from(this.viewedWordsInModule));const e=this.wordsInSelectedModule.length;if(e!==0)if(this.viewedWordsInModule.size>=v&&!this.midModulePracticeCompleted&&e>v){console.log("Triggering mid-module practice."),this.midModulePracticeCompleted=!0;const o=Array.from(this.viewedWordsInModule).slice(0,v);this.startPracticeSession(o,`Práctica: Primeras ${v} Palabras`)}else this.viewedWordsInModule.size===e&&!this.endModulePracticeCompleted&&(console.log("Triggering end-of-module practice."),this.endModulePracticeCompleted=!0,this.startPracticeSession(Array.from(this.viewedWordsInModule),"Práctica: Todas las Palabras del Módulo"))}async function V(t,e){if(!t||t.length===0){console.warn("No words provided for practice session."),this.currentView="menu";return}this.closeMobileMenu(),this.isPracticeActive=!0,this.isLoadingPractice=!0,this.currentView="practice",this.practiceSessionTitle=e,this.practiceExercises=[],this.currentExerciseIndex=-1,this.currentExercise=null,this.userAnswer=null,this.feedbackMessage={type:"",text:""},this.practiceCompletionMessage="";const o=document.getElementById("view-container");o&&this.practiceViewHtml&&(o.innerHTML=this.practiceViewHtml,await new Promise(a=>setTimeout(a,150))),console.log("Starting practice session for word IDs:",t);const r=`
        SELECT feb.id, feb.word_id, feb.sentence AS questionText, feb.distractor_words_json, w.term AS correctAnswerTerm
        FROM fill_in_blank_exercises feb
        JOIN words w ON feb.word_id = w.id
        WHERE feb.word_id IN (${t.map(()=>"?").join(",")});
    `,s=`
        SELECT fce.id, fce.word_id, fce.conversation_json AS questionTextJson, fce.distractor_words_json, w.term AS correctAnswerTerm
        FROM fill_in_conversation_exercises fce
        JOIN words w ON fce.word_id = w.id
        WHERE fce.word_id IN (${t.map(()=>"?").join(",")});
    `,i=this.executeQuery(r,t)||[],l=this.executeQuery(s,t)||[];i.forEach(a=>{let d=[];try{d=JSON.parse(a.distractor_words_json||"[]")}catch(n){console.error("Error parsing distractor_words_json for blank ex:",n,a.distractor_words_json)}this.practiceExercises.push({...a,type:"fill-blank",options:this.shuffleArray([a.correctAnswerTerm,...d])})}),l.forEach(a=>{let d=[],n=[];try{d=JSON.parse(a.distractor_words_json||"[]")}catch(u){console.error("Error parsing distractor_words_json for convo ex:",u,a.distractor_words_json)}try{n=JSON.parse(a.questionTextJson||"[]"),n=n.map(u=>({speaker:u.speaker||"Speaker",line:u.line||u.text||"Missing text"}))}catch(u){console.error("Error parsing conversation_json:",u,a.questionTextJson),n=[{speaker:"Error",line:"No se pudo cargar la conversación."}]}this.practiceExercises.push({...a,questionText:n,type:"fill-conversation",options:this.shuffleArray([a.correctAnswerTerm,...d])})}),this.shuffleArray(this.practiceExercises),console.log("Prepared practice exercises:",this.practiceExercises),this.practiceExercises.length>0?(this.currentExerciseIndex=0,this.displayCurrentExercise()):(this.practiceCompletionMessage="No se encontraron ejercicios de práctica para este conjunto de palabras.",this.currentExercise=null),this.isLoadingPractice=!1}function q(){this.userAnswer=null,this.feedbackMessage={type:"",text:""},this.currentExerciseIndex>=0&&this.currentExerciseIndex<this.practiceExercises.length?(this.currentExercise=this.practiceExercises[this.currentExerciseIndex],console.log("Displaying exercise:",this.currentExerciseIndex+1,this.currentExercise)):(this.currentExercise=null,this.practiceCompletionMessage=this.practiceExercises.length>0?"¡Sesión de práctica completada! Bien hecho.":"No había ejercicios disponibles para esta sesión.",console.log("Practice session ended or no exercises."))}function z(t){this.feedbackMessage.text===""&&(this.userAnswer=t)}function J(){!this.userAnswer||!this.currentExercise||(this.userAnswer===this.currentExercise.correctAnswerTerm?this.feedbackMessage={type:"success",text:"¡Bien hecho!"}:this.feedbackMessage={type:"error",text:`La respuesta correcta era ${this.currentExercise.correctAnswerTerm}`})}function Y(){this.currentExerciseIndex<this.practiceExercises.length-1?(this.currentExerciseIndex++,this.displayCurrentExercise()):this.displayCurrentExercise()}function U(){this.isPracticeActive=!1,this.currentView="menu"}const G=Object.freeze(Object.defineProperty({__proto__:null,displayCurrentExercise:q,finishPracticeSession:U,nextExercise:Y,selectAnswer:z,startPracticeSession:V,submitAnswer:J,trackViewedWord:B},Symbol.toStringTag,{value:"Module"}));function K(){return{db:null,isLoading:!0,isLoadingHtmlViews:!0,error:null,currentView:"menu",isMobileMenuOpen:!1,menuViewHtml:'<p class="text-center text-gray-500">Loading menu view...</p>',wordDetailViewHtml:'<p class="text-center text-gray-500">Loading word detail view...</p>',practiceViewHtml:'<p class="text-center text-gray-500">Loading practice view...</p>',modules:[],allWordsFlat:[],selectedModuleId:null,wordsInSelectedModule:[],selectedWordId:null,targetLanguageCode:x,currentWord:null,isLoadingWordDetails:!1,selectedWordDetails:{term:null,definition:null,audio_data:null,translation:null},selectedWordExamples:[],selectedWordConversations:[],selectedWordClips:[],audioPlayer:new Audio,viewedWordsInModule:new Set,midModulePracticeCompleted:!1,endModulePracticeCompleted:!1,isPracticeActive:!1,isLoadingPractice:!1,practiceSessionTitle:"",practiceExercises:[],currentExerciseIndex:-1,currentExercise:null,userAnswer:null,feedbackMessage:{type:"",text:""},practiceCompletionMessage:""}}console.log("[main.js] Script start");function Z(){return{...K(),...O,toggleMobileMenu(){console.log("[appState] toggleMobileMenu() called, current state:",this.isMobileMenuOpen),console.log("[appState] toggleMobileMenu() event source check - Alpine component available:",!!this),this.isMobileMenuOpen=!this.isMobileMenuOpen,console.log("[appState] toggleMobileMenu() new state:",this.isMobileMenuOpen),this.isMobileMenuOpen?(document.body.classList.add("overflow-hidden"),console.log("[appState] Added overflow-hidden to body")):(document.body.classList.remove("overflow-hidden"),console.log("[appState] Removed overflow-hidden from body"))},closeMobileMenu(){console.log("[appState] closeMobileMenu() called, current state:",this.isMobileMenuOpen),this.isMobileMenuOpen?(this.isMobileMenuOpen=!1,document.body.classList.remove("overflow-hidden"),console.log("[appState] Menu closed, state set to false")):console.log("[appState] Menu was already closed")},...H,...Q,...G,async init(){console.log("[appState] init()"),window.appStateInstance=this;const e=window.innerWidth>=768;this.isMobileMenuOpen=e,document.body.classList.remove("overflow-hidden"),console.log("[appState] Mobile menu state initialized - Desktop:",e,"Menu open:",this.isMobileMenuOpen);try{console.log("[appState] Step 1: Initializing database..."),await R.call(this),console.log("[appState] Database initialized successfully"),console.log("[appState] Step 2: Loading HTML views..."),await D.call(this),console.log("[appState] HTML views loaded successfully"),console.log("[appState] Step 3: Checking database schema...");const o=this.checkDatabaseSchema();console.log("[appState] Step 4: Loading modules..."),o.hasModulesTable?this.loadModules():(console.log("[appState] No modules table found, will extract from words"),this.modules=[]),console.log("[appState] Modules loaded, count:",this.modules?this.modules.length:0),console.log("[appState] Step 5: Loading words for navigation..."),await this.loadAllWordsForNavigation(),console.log("[appState] Words loaded, count:",this.allWordsFlat?this.allWordsFlat.length:0),console.log("[appState] Step 6: Showing menu view..."),await this.showMenuView(),console.log("[appState] Menu view displayed"),this.isLoading=!1,console.log("[appState] Initialization complete!")}catch(o){console.error("[appState] initialisation failed:",o),this.error=o.message,this.isLoading=!1}},executeQuery(e,o=[]){return I.call(this,e,o)},checkDatabaseSchema(){var e,o;try{const s=this.executeQuery("SELECT name FROM sqlite_master WHERE type='table'")||[];console.log("[appState] Available tables:",s.map(a=>a.name));const i=s.some(a=>a.name.toLowerCase()==="modules");console.log("[appState] Has modules table:",i);const l=s.some(a=>a.name.toLowerCase()==="clips");if(console.log("[appState] Has clips table:",l),s.some(a=>a.name.toLowerCase()==="words")){const a=this.executeQuery("PRAGMA table_info(words)")||[];console.log("[appState] Words table structure:",a)}if(l){const a=this.executeQuery("PRAGMA table_info(clips)")||[];console.log("[appState] Clips table structure:",a);const d=this.executeQuery("SELECT COUNT(*) as count FROM clips")||[];if(console.log("[appState] Total clips in database:",((e=d[0])==null?void 0:e.count)||0),((o=d[0])==null?void 0:o.count)>0){const n=this.executeQuery("SELECT * FROM clips LIMIT 3")||[];console.log("[appState] Sample clips:",n);const u=this.executeQuery(`
                            SELECT w.id, w.term, COUNT(c.id) as clip_count 
                            FROM words w 
                            LEFT JOIN clips c ON w.id = c.word_id 
                            WHERE c.id IS NOT NULL 
                            GROUP BY w.id, w.term 
                            ORDER BY clip_count DESC 
                            LIMIT 5
                        `)||[];console.log("[appState] Words with clips:",u)}}return{tables:s,hasModulesTable:i,hasClipsTable:l}}catch(r){return console.error("[appState] Error checking database schema:",r),{tables:[],hasModulesTable:!1,hasClipsTable:!1}}},async loadAllWordsForNavigation(){try{const e=`
                    SELECT w.*, m.id as module_id, m.name as module_name, m.description as module_description
                    FROM words w
                    JOIN word_module_assignments wma ON w.id = wma.word_id
                    JOIN modules m ON wma.module_id = m.id
                    ORDER BY m.name, w.term
                `;if(this.allWordsFlat=this.executeQuery(e)??[],console.log("[appState] Loaded words with modules:",this.allWordsFlat.length),(!this.modules||this.modules.length===0)&&this.allWordsFlat.length>0){console.log("[appState] Extracting modules from words data...");const o=new Map;this.allWordsFlat.forEach(r=>{r.module_id&&!o.has(r.module_id)&&o.set(r.module_id,{id:r.module_id,name:r.module_name||`Módulo ${r.module_id}`,description:r.module_description||"Módulo que contiene palabras"})}),this.modules=Array.from(o.values()),console.log("[appState] Extracted modules:",this.modules)}this.populateWordNavigation()}catch(e){console.error("[appState] loadAllWordsForNavigation() error:",e),this.error="Error al cargar las palabras para la navegación",this.modules&&this.modules.length>0&&(console.log("[appState] Fallback: showing modules without words"),this.populateModulesOnly())}},populateModulesOnly(){const e=document.getElementById("word-navigation-list");if(!e){console.error("[appState] Navigation list element not found");return}console.log("[appState] Populating navigation with modules only");const o=e.querySelector('[x-show="isLoading"]');e.innerHTML="",o&&e.appendChild(o),this.modules.forEach(r=>{const s=document.createElement("li");s.className="font-semibold text-purple-700 mt-4 mb-2 border border-purple-200 rounded-lg p-3 cursor-pointer hover:bg-purple-50 transition-colors",s.innerHTML=`
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="text-sm font-bold">${r.name}</div>
                            ${r.description?`<div class="text-xs text-purple-600 font-normal mt-1">${r.description}</div>`:""}
                        </div>
                        <span class="module-toggle text-purple-500">▼</span>
                    </div>
                `;const i=document.createElement("div");i.className="module-words hidden mt-2 ml-4 space-y-1",i.setAttribute("data-module-id",r.id),s.addEventListener("click",async()=>{const l=s.querySelector(".module-toggle");!i.classList.contains("hidden")?(i.classList.add("hidden"),l.textContent="▼"):(i.children.length===0&&await this.loadWordsForModuleNavigation(r.id,i),i.classList.remove("hidden"),l.textContent="▲",this.selectModule(r.id))}),e.appendChild(s),e.appendChild(i)}),console.log("[appState] Navigation populated with modules only")},async loadWordsForModuleNavigation(e,o){try{const s=this.executeQuery(`
                    SELECT w.id, w.term
                    FROM words w
                    JOIN word_module_assignments wma ON w.id = wma.word_id
                    WHERE wma.module_id = ?
                    ORDER BY w.term
                `,[e])||[];o.innerHTML="",s.forEach((c,g)=>{const h=document.createElement("div");if(h.className="cursor-pointer p-2 rounded hover:bg-purple-100 transition-colors text-sm border-l-2 border-purple-200 pl-3",h.textContent=c.term||"Palabra desconocida",h.addEventListener("click",p=>{p.stopPropagation(),this.selectWordFromNav(c.id)}),o.appendChild(h),g===4&&s.length>5){const p=document.createElement("div");p.className="my-3 p-3 bg-blue-50 rounded-lg border border-blue-200";const f=document.createElement("button");f.className="w-full text-left px-3 py-2 text-sm bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors border border-blue-300 font-medium",f.textContent="📝 Practicar Primeras 5 Palabras",f.addEventListener("click",b=>{b.stopPropagation();const w=s.slice(0,5).map(y=>y.id);this.startPracticeSession(w,`Práctica: Primeras 5 Palabras - ${n}`)}),p.appendChild(f),o.appendChild(p)}});const i=document.createElement("div");i.className="mt-3 space-y-2 border-t border-gray-200 pt-3";const a=s.map(c=>c.id),d=this.modules.find(c=>c.id==e),n=d?d.name:`Módulo ${e}`;if(s.length>5){const c=document.createElement("div");c.className="p-2 bg-gray-50 rounded border border-gray-200";const g=document.createElement("button");g.className="w-full text-left px-2 py-1 text-xs text-orange-600 rounded hover:bg-orange-50 transition-colors border-0 font-normal";const h=s.length-5;g.textContent=`🎯 Practicar ${h} Palabras Restantes`,g.addEventListener("click",p=>{p.stopPropagation();const f=a.slice(5);this.startPracticeSession(f,`Práctica: ${h} Palabras Restantes - ${n}`)}),c.appendChild(g),i.appendChild(c)}const u=document.createElement("div");u.className="p-2 bg-gray-50 rounded border border-gray-200";const m=document.createElement("button");m.className="w-full text-left px-2 py-1 text-xs text-green-600 rounded hover:bg-green-50 transition-colors border-0 font-normal",m.textContent=`📚 Practicar Todas las ${s.length} Palabras`,m.addEventListener("click",c=>{c.stopPropagation(),this.startPracticeSession(a,`Práctica: Todas las Palabras - ${n}`)}),u.appendChild(m),i.appendChild(u),o.appendChild(i),console.log(`[appState] Loaded ${s.length} words for module ${e}`)}catch(r){console.error(`[appState] Error loading words for module ${e}:`,r),o.innerHTML='<div class="text-red-500 text-xs p-2">Error al cargar las palabras</div>'}},populateWordNavigation(){const e=document.getElementById("word-navigation-list");if(!e){console.error("[appState] Navigation list element not found");return}if(!this.allWordsFlat||this.allWordsFlat.length===0){console.warn("[appState] No words available for navigation");return}console.log("[appState] Populating navigation with",this.allWordsFlat.length,"words");const o=e.querySelector('[x-show="isLoading"]');e.innerHTML="",o&&e.appendChild(o);const r={};this.allWordsFlat.forEach(s=>{const i=s.module_id||"ungrouped";r[i]||(r[i]=[]),r[i].push(s)}),console.log("[appState] Words grouped by module:",r),Object.keys(r).forEach(s=>{const i=this.modules.find(p=>p.id==s),l=i?i.name:`Módulo ${s}`,a=i?i.description:"",d=document.createElement("li");d.className="font-semibold text-purple-700 mt-4 mb-2 border border-purple-200 rounded-lg p-3 cursor-pointer hover:bg-purple-50 transition-colors",d.innerHTML=`
                    <div class="flex justify-between items-center">
                        <div>
                            <div class="text-sm font-bold">${l}</div>
                            ${a?`<div class="text-xs text-purple-600 font-normal mt-1">${a}</div>`:""}
                        </div>
                        <span class="module-toggle text-purple-500">▼</span>
                    </div>
                `;const n=document.createElement("div");n.className="module-words hidden mt-2 ml-4 space-y-1",n.setAttribute("data-module-id",s),r[s].forEach((p,f)=>{const b=document.createElement("div");if(b.className="cursor-pointer p-2 rounded hover:bg-purple-100 transition-colors text-sm border-l-2 border-purple-200 pl-3",b.textContent=p.term||"Palabra desconocida",b.addEventListener("click",w=>{w.stopPropagation(),this.selectWordFromNav(p.id)}),n.appendChild(b),f===4&&r[s].length>5){const w=document.createElement("div");w.className="my-2 p-2 bg-gray-50 rounded border border-gray-200";const y=document.createElement("button");y.className="w-full text-left px-2 py-1 text-xs text-blue-600 rounded hover:bg-blue-50 transition-colors border-0 font-normal",y.textContent="📝 Practicar Primeras 5 Palabras",y.addEventListener("click",W=>{W.stopPropagation();const L=r[s].slice(0,5).map(P=>P.id);this.startPracticeSession(L,`Práctica: Primeras 5 Palabras - ${l}`)}),w.appendChild(y),n.appendChild(w)}});const u=document.createElement("div");u.className="mt-3 space-y-2 border-t border-gray-200 pt-3";const m=r[s],c=m.map(p=>p.id);if(m.length>5){const p=document.createElement("div");p.className="p-2 bg-gray-50 rounded border border-gray-200";const f=document.createElement("button");f.className="w-full text-left px-2 py-1 text-xs text-orange-600 rounded hover:bg-orange-50 transition-colors border-0 font-normal";const b=m.length-5;f.textContent=`🎯 Practicar ${b} Palabras Restantes`,f.addEventListener("click",w=>{w.stopPropagation();const y=c.slice(5);this.startPracticeSession(y,`Práctica: ${b} Palabras Restantes - ${l}`)}),p.appendChild(f),u.appendChild(p)}const g=document.createElement("div");g.className="p-2 bg-gray-50 rounded border border-gray-200";const h=document.createElement("button");h.className="w-full text-left px-2 py-1 text-xs text-green-600 rounded hover:bg-green-50 transition-colors border-0 font-normal",h.textContent=`📚 Practicar Todas las ${m.length} Palabras`,h.addEventListener("click",p=>{p.stopPropagation(),this.startPracticeSession(c,`Práctica: Todas las Palabras - ${l}`)}),g.appendChild(h),u.appendChild(g),n.appendChild(u),d.addEventListener("click",()=>{const p=d.querySelector(".module-toggle");!n.classList.contains("hidden")?(n.classList.add("hidden"),p.textContent="▼"):(n.classList.remove("hidden"),p.textContent="▲",this.selectModule(s))}),e.appendChild(d),e.appendChild(n)}),console.log("[appState] Navigation populated successfully")},async selectWordFromNav(e){console.log("[appState] selectWordFromNav()",e),this.selectedWordId=e,this.closeMobileMenu(),await this.showWordDetail(e)},async showMenuView(){console.log("[appState] showMenuView()"),this.currentView="menu";const e=document.getElementById("view-container");e&&(e.innerHTML=`
                    <div class="pt-16 md:pt-0">
                        <div class="text-center py-20">
                            <h1 class="text-3xl font-bold text-purple-700 mb-4">Curso de Aprendizaje de Idiomas</h1>
                            <p class="text-lg text-gray-600 mb-6">Selecciona un módulo del panel de navegación para comenzar a aprender.</p>
                            <div class="bg-white p-8 rounded-lg shadow-md max-w-2xl mx-auto">
                                <h2 class="text-xl font-semibold text-purple-600 mb-4">Cómo Usar Este Curso</h2>
                                <div class="text-left space-y-3 text-gray-700">
                                    <p>• <strong>Explorar Módulos:</strong> Haz clic en cualquier módulo en el panel izquierdo para expandir y ver sus palabras</p>
                                    <p>• <strong>Estudiar Palabras:</strong> Haz clic en palabras individuales para ver información detallada, ejemplos y audio</p>
                                    <p>• <strong>Sesiones de Práctica:</strong> Cada módulo tiene opciones de práctica estratégicamente ubicadas:</p>
                                    <p class="ml-6">📝 <strong>Practicar Primeras 5 Palabras</strong> - Aparece después de la 5ª palabra</p>
                                    <p class="ml-6">🎯 <strong>Practicar Palabras Restantes</strong> - Aparece al final para las palabras 6+</p>
                                    <p class="ml-6">📚 <strong>Practicar Todas las Palabras</strong> - Revisión completa del módulo al final</p>
                                    <p>• <strong>Tipos de Ejercicios:</strong> La práctica incluye completar oraciones y conversaciones</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `)},async showWordDetail(e){console.log("[appState] showWordDetail()",e),this.currentView="word",this.selectedWordId=e,this.isLoadingWordDetails=!0;const o=document.getElementById("view-container");if(o&&this.wordDetailViewHtml&&(o.innerHTML=this.wordDetailViewHtml,await new Promise(r=>setTimeout(r,150))),await this.loadWordDetailsById(e),this.currentWord&&this.currentWord.clips){console.log("[appState] Rendering clips with plain JS:",this.currentWord.clips.length);let r=0;const s=10,i=async()=>{if(r++,document.getElementById("youtube-clips-container"))return console.log("[appState] Container found on attempt",r,", rendering clips..."),this.renderYouTubeClips(this.currentWord.clips,"youtube-clips-container"),!0;if(r<s)return console.log("[appState] Container not found, attempt",r,"of",s,", retrying in 100ms..."),await new Promise(a=>setTimeout(a,100)),i();{console.error("[appState] youtube-clips-container not found after",s,"attempts");const a=document.createElement("div");a.id="youtube-clips-container",a.className="space-y-4 mt-6";const d=document.querySelector(".bg-white.p-6.rounded-lg.shadow-md.space-y-6");return d?(d.appendChild(a),console.log("[appState] Created fallback container, rendering clips..."),this.renderYouTubeClips(this.currentWord.clips,"youtube-clips-container"),!0):!1}};await i()}else console.log("[appState] No clips to render");this.isLoadingWordDetails=!1},async loadWordDetailsById(e){if(!this.db||!e){this.error="La base de datos no está disponible o no se proporcionó ID de palabra.";return}try{const r=this.executeQuery("SELECT * FROM words WHERE id = ?",[e]);if(r&&r.length>0){const s=r[0];let i=null;try{const a=this.executeQuery("SELECT translation FROM words_translations WHERE words_id = ? AND language_code = ?",[e,x]);a&&a.length>0&&(i=a[0].translation),console.log("[appState] Word translation query result:",a,"for language:",x)}catch(l){console.warn("[appState] Word translations table not available or error loading translation:",l)}this.currentWord={id:s.id,term:s.term,definition:s.definition,translation:i||s.translation,pronunciation:s.pronunciation,audioSrc:s.audio_data,exampleSentences:[],conversation:[],clips:[],notes:s.notes},this.selectedWordDetails={...s,translation:i||s.translation};try{const a=this.executeQuery("SELECT * FROM examples WHERE word_id = ?",[e])||[];this.selectedWordExamples=a,this.currentWord.exampleSentences=await Promise.all(a.map(async d=>{let n=null;try{const m=this.executeQuery("SELECT translation FROM example_translations WHERE example_id = ? AND language_code = ?",[d.id,x]);m&&m.length>0&&(n=m[0].translation)}catch(u){console.warn("[appState] Example translations table not available:",u)}return{english:d.text,translation:n,audioSrc:d.audio_data}}))}catch(l){console.warn("[appState] Examples table not available or error loading examples:",l),this.selectedWordExamples=[],this.currentWord.exampleSentences=[]}try{const a=this.executeQuery("SELECT * FROM conversation_lines WHERE word_id = ? ORDER BY id",[e])||[];if(this.selectedWordConversations=a,console.log("[appState] Raw conversation data:",a),a.length>0){const d=await Promise.all(a.map(async c=>{let g=null;try{const p=this.executeQuery("SELECT translation FROM conversation_line_translations WHERE conversation_line_id = ? AND language_code = ?",[c.id,x]);p&&p.length>0&&(g=p[0].translation)}catch(h){console.warn("[appState] Conversation translations table not available:",h)}return{speaker:c.speaker_label||"Speaker",line:c.text,translatedLine:g,audioSrc:c.audio_data,lineOrder:c.line_order,dbId:c.id}})),n=[];let u=[],m=-1;d.forEach(c=>{(c.lineOrder===0||c.lineOrder<m)&&u.length>0&&(n.push([...u]),u=[]),u.push(c),m=c.lineOrder}),u.length>0&&n.push(u),n.forEach(c=>{c.sort((g,h)=>(g.lineOrder||0)-(h.lineOrder||0))}),console.log("[appState] Grouped conversations:",n),this.currentWord.conversation=n.map(c=>({lines:c}))}}catch(l){console.warn("[appState] Conversations table not available or error loading conversations:",l),this.selectedWordConversations=[],this.currentWord.conversation=[]}try{console.log("[appState] Loading clips for word ID:",e);const a=this.executeQuery("SELECT * FROM clips WHERE word_id = ?",[e])||[];console.log("[appState] Clips query result for word",e,":",a),console.log("[appState] Number of clips found:",a.length),a.length>0&&a.forEach((d,n)=>{console.log(`[appState] Clip ${n+1}:`,{id:d.id,youtube_url:d.youtube_url,start_sec:d.start_sec})}),this.selectedWordClips=a,this.currentWord.clips=a,console.log("[appState] Clips assigned to currentWord:",this.currentWord.clips)}catch(l){console.warn("[appState] Clips table not available or error loading clips:",l),console.warn("[appState] Error details:",l.message),this.selectedWordClips=[],this.currentWord.clips=[]}console.log("[appState] Word details loaded for:",e,this.currentWord)}else this.error=`Palabra con ID ${e} no encontrada.`,this.currentWord=null}catch(o){console.error("[appState] loadWordDetailsById() error:",o),this.error="Error al cargar los detalles de la palabra",this.currentWord=null}},clearWordDetails(){this.selectedWordDetails={term:null,definition:null,audio_data:null,translation:null},this.selectedWordExamples=[],this.selectedWordConversations=[],this.selectedWordClips=[],this.currentWord=null},initiatePractice(e){if(!Array.isArray(e)||e.length===0)return;console.log("[appState] initiatePractice()",e.length,"words");const o=e.map(r=>r.id).filter(r=>r);if(o.length===0){console.warn("[appState] No valid word IDs found for practice");return}this.startPracticeSession(o,`Práctica: Todas las ${o.length} Palabras`)},renderYouTubeClips(e,o){_(e,o)}}}function S(){return typeof Alpine<"u"?(console.log("[main.js] Registering Alpine component"),Alpine.data("appState",Z),console.log("[main.js] Alpine component registered successfully"),!0):!1}if(S())console.log("[main.js] Component registered immediately");else{document.addEventListener("alpine:init",()=>{console.log("[main.js] Alpine init event fired, registering component"),S()});let t=0;const e=setInterval(()=>{t++,S()?(console.log("[main.js] Component registered after",t*100,"ms"),clearInterval(e)):t>50&&(console.error("[main.js] Failed to register component after 5 seconds"),clearInterval(e))},100)}console.log("[main.js] Script end");
